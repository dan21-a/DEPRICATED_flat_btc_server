{"filter":false,"title":"swarm_redistribution.js","tooltip":"/swarm_redistribution.js","undoManager":{"mark":100,"position":100,"stack":[[{"group":"doc","deltas":[{"start":{"row":43,"column":13},"end":{"row":43,"column":14},"action":"remove","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":43,"column":13},"end":{"row":43,"column":14},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":43,"column":14},"end":{"row":43,"column":15},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":43,"column":15},"end":{"row":43,"column":16},"action":"insert","lines":["f"]}]}],[{"group":"doc","deltas":[{"start":{"row":43,"column":16},"end":{"row":43,"column":17},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":43,"column":17},"end":{"row":43,"column":18},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":43,"column":18},"end":{"row":43,"column":19},"action":"insert","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":43,"column":19},"end":{"row":43,"column":20},"action":"insert","lines":["_"]}]}],[{"group":"doc","deltas":[{"start":{"row":43,"column":20},"end":{"row":43,"column":21},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":43,"column":21},"end":{"row":43,"column":22},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":43,"column":22},"end":{"row":43,"column":23},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":46,"column":0},"end":{"row":47,"column":2},"action":"remove","lines":["    function get_dividend_pathway(taxRate, currency, total_amount){","  "]}]}],[{"group":"doc","deltas":[{"start":{"row":45,"column":4},"end":{"row":46,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":44,"column":0},"end":{"row":45,"column":4},"action":"remove","lines":["    get_dividend_pathway()","    "]}]}],[{"group":"doc","deltas":[{"start":{"row":45,"column":0},"end":{"row":46,"column":0},"action":"remove","lines":["    console.log(\"scanning collection: \"+ COLLECTION);",""]}]}],[{"group":"doc","deltas":[{"start":{"row":47,"column":16},"end":{"row":48,"column":0},"action":"remove","lines":[", taxRate, total_amount)",""]}]}],[{"group":"doc","deltas":[{"start":{"row":47,"column":16},"end":{"row":47,"column":17},"action":"insert","lines":[")"]}]}],[{"group":"doc","deltas":[{"start":{"row":41,"column":0},"end":{"row":42,"column":0},"action":"remove","lines":["var q = 0//loop through all currencies",""]}]}],[{"group":"doc","deltas":[{"start":{"row":41,"column":0},"end":{"row":42,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":40,"column":4},"end":{"row":41,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":40,"column":0},"end":{"row":40,"column":4},"action":"remove","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":4},"end":{"row":40,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":0},"end":{"row":39,"column":4},"action":"remove","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":38,"column":4},"end":{"row":39,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":38,"column":0},"end":{"row":38,"column":4},"action":"remove","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":4},"end":{"row":38,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":0},"end":{"row":37,"column":4},"action":"remove","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":4},"end":{"row":37,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":0},"end":{"row":36,"column":4},"action":"remove","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":47,"column":0},"end":{"row":65,"column":3},"action":"remove","lines":["function passport_check(callback){","    //todo: finish this","// checks relative all passports in COLLECTION","COLLECTION.find({type: \"passports\"}, function(err,doc){","    ","    for(var i=0;i<doc.length;i++){","        ","//placeholder function","","    }","    ","})","    ","    ","ACCOUNT_ID.findOne({type: \"passports\", snapswap_certificate: Boolean},function(err, doc) {","  callback(doc.snapswap_certificate)","}); ","","}  "]}]}],[{"group":"doc","deltas":[{"start":{"row":46,"column":0},"end":{"row":47,"column":2},"action":"remove","lines":["","  "]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":0},"end":{"row":39,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":4},"end":{"row":39,"column":8},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":0},"end":{"row":39,"column":4},"action":"remove","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":4},"end":{"row":39,"column":5},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":5},"end":{"row":39,"column":6},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":6},"end":{"row":39,"column":7},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":7},"end":{"row":39,"column":8},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":8},"end":{"row":39,"column":9},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":9},"end":{"row":39,"column":10},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":10},"end":{"row":39,"column":11},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":11},"end":{"row":39,"column":12},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":12},"end":{"row":39,"column":13},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":13},"end":{"row":39,"column":14},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":14},"end":{"row":39,"column":15},"action":"insert","lines":["g"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":15},"end":{"row":39,"column":17},"action":"insert","lines":["()"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":16},"end":{"row":39,"column":17},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":17},"end":{"row":39,"column":18},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":18},"end":{"row":39,"column":19},"action":"insert","lines":["f"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":19},"end":{"row":39,"column":20},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":20},"end":{"row":39,"column":21},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":20},"end":{"row":39,"column":21},"action":"remove","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":19},"end":{"row":39,"column":20},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":18},"end":{"row":39,"column":19},"action":"remove","lines":["f"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":17},"end":{"row":39,"column":18},"action":"remove","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":16},"end":{"row":39,"column":17},"action":"remove","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":16},"end":{"row":39,"column":17},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":17},"end":{"row":39,"column":18},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":18},"end":{"row":39,"column":19},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":19},"end":{"row":39,"column":20},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":20},"end":{"row":39,"column":21},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":21},"end":{"row":39,"column":22},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":22},"end":{"row":39,"column":23},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":23},"end":{"row":39,"column":24},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":24},"end":{"row":39,"column":25},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":25},"end":{"row":39,"column":26},"action":"insert","lines":["_"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":26},"end":{"row":39,"column":27},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":27},"end":{"row":39,"column":28},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":28},"end":{"row":39,"column":29},"action":"insert","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":29},"end":{"row":39,"column":30},"action":"insert","lines":["w"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":30},"end":{"row":39,"column":31},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":30},"end":{"row":39,"column":31},"action":"remove","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":29},"end":{"row":39,"column":30},"action":"remove","lines":["w"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":28},"end":{"row":39,"column":29},"action":"remove","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":28},"end":{"row":39,"column":29},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":29},"end":{"row":39,"column":30},"action":"insert","lines":["h"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":30},"end":{"row":39,"column":31},"action":"insert","lines":["w"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":31},"end":{"row":39,"column":32},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":32},"end":{"row":39,"column":33},"action":"insert","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":34},"end":{"row":40,"column":0},"action":"insert","lines":["",""]},{"start":{"row":40,"column":0},"end":{"row":40,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":40,"column":0},"end":{"row":40,"column":4},"action":"remove","lines":["    "]},{"start":{"row":40,"column":0},"end":{"row":41,"column":0},"action":"insert","lines":["    console.log(doc.total_pathway)",""]}]}],[{"group":"doc","deltas":[{"start":{"row":40,"column":19},"end":{"row":40,"column":21},"action":"insert","lines":["[]"]}]}],[{"group":"doc","deltas":[{"start":{"row":40,"column":20},"end":{"row":40,"column":21},"action":"insert","lines":["+"]}]}],[{"group":"doc","deltas":[{"start":{"row":40,"column":20},"end":{"row":40,"column":21},"action":"remove","lines":["+"]}]}],[{"group":"doc","deltas":[{"start":{"row":40,"column":20},"end":{"row":40,"column":21},"action":"insert","lines":["0"]}]}],[{"group":"doc","deltas":[{"start":{"row":40,"column":20},"end":{"row":40,"column":21},"action":"remove","lines":["0"]}]}],[{"group":"doc","deltas":[{"start":{"row":40,"column":0},"end":{"row":41,"column":0},"action":"remove","lines":["    console.log(doc[].total_pathway)",""]}]}],[{"group":"doc","deltas":[{"start":{"row":38,"column":19},"end":{"row":38,"column":20},"action":"insert","lines":["O"]}]}],[{"group":"doc","deltas":[{"start":{"row":38,"column":20},"end":{"row":38,"column":21},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":38,"column":21},"end":{"row":38,"column":22},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":0},"end":{"row":49,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":49,"column":0},"end":{"row":50,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":50,"column":0},"end":{"row":51,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":51,"column":0},"end":{"row":52,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":52,"column":0},"end":{"row":53,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":53,"column":0},"end":{"row":54,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":54,"column":0},"end":{"row":234,"column":29},"action":"remove","lines":["","var get_collection = function() {","    //connect your coin here, this is how you connect to the API","    //the callback feeds collection/dividend-pathways","    //this example connects with http://client.basicincome.co","COLLECTION = db.collection(ACCOUNT);","get_dividend_lines(swarm_redistribution)","}","get_collection()","","","// -------------------------- STUFF:","// ALL THIS needs to be improved...","","    var lines = [];//lines.push(line)","   ","    ","    var x = 0;//recursion()","    var y = 0;//recursion()","    var z = 0","   ","    var taxRate_quota_sum = 0","    var taxRate_switch = false","    var taxRate_x;","    var taxRate_ratio_x;","","","","","","// ---------------------- SWARM-REDISTRIBUTION ----------------------------","","function swarm_redistribution(pathway, taxRate, total_amount){","","","// ------- First, construct fractal dividend lines -----------------","// see http://www.resilience.me/theory.html","",""," var w = 0;"," var line = []"," "," taxRate_x = taxRate"," taxRate_ratio_x = 1","","",""," if(pathway.length>0){","","    loop(pathway, line, w, taxRate, total_amount);// add taxRate ratios","    "," }"," else{"," console.log(\"collection is empty\")"," next_node(total_amount)"," }","","    ","    ","    function loop(pathway, line, w, taxRate, total_amount) {","    // calculate taxRatio","    function calculate_taxRatio(pathway, line, w, taxRate, total_amount){","    var taxRate_y = pathway[w].taxRate","   ","    if(taxRate_y > taxRate_x)taxRate_y = taxRate_x","    var taxRate_ratio_y = Number(taxRate_y) / Number(taxRate_x)","    var taxRate_quota = Number(taxRate_ratio_x) * Number(taxRate_ratio_y)","    push_lines(taxRate_quota, total_amount)","    }","    calculate_taxRatio(pathway, line, w, taxRate, total_amount)","","    function push_lines(taxRate_quota, total_amount){","","","    function check(boolean){","        if(boolean === true){","            taxRate_quota_sum = Number(taxRate_quota_sum) + Number(taxRate_quota)","            console.log(\"passport OK\")","        }","    }","    ","    // push lines","    if (JSON.stringify(lines).indexOf(pathway[w].account) === -1 && pathway[w].account !== account_id){","    line.push({account: pathway[w].account, currency: pathway[w].currency, taxRate: taxRate, taxRate_quota: taxRate_quota, node: ACCOUNT});","    ","    //todo: passport check","    passport_check(check)","    ","    ","    }","    else console.log(\"CIRCULAR\");","    ","    w++;","    console.log(w)","    ","    if (w<pathway.length){loop(pathway, line, w, taxRate, total_amount)}","    else {","        if (line.length>0){","            lines.push(line)","        };","        console.log(lines)","        next_node(total_amount)","    }","    }","    }","","      ","// STEP 2: branch out (add all dividend pathways for lines[x][i].account)        ","","","    function next_node(total_amount){","            if(x<lines.length){","            ","                ","        if(y<lines[x].length){","            taxRate_ratio_x = Number(lines[x][y].taxRate_quota)","            taxRate_x = lines[x][y].taxRate","            ACCOUNT = lines[x][y].account;","            ","            y++;","            z++","            console.log(\"recursion nr \"+z)","            get_collection();","        }","                ","        else {","            x++;","            y = 0","            next_node(total_amount)","          ","        }","        ","            }","            else console.log(lines), console.log(\"generating payments...\"), outgoing_payments(total_amount)","        }","         ","             ","    // ------- SECOND, outgoing payments -----------------","    // see http://www.resilience.me/theory.html ","    function outgoing_payments(total_amount){","         var total_amount_pie = Number(total_amount)/taxRate_quota_sum","         ","         // create outgoing payment","         x = 0","         y = 0","         loop()","         function loop(){","","            if (x<lines.length){     ","                if (y<lines[x].length){","                    //todo: passport check","            passport_check(check)","                function check(boolean){","                     if(boolean === true){","                         ","                 console.log(lines[x][y])","                var amount = Number(total_amount_pie * lines[x][y].taxRate_quota)","                var currency = lines[x][y].currency","                var account = lines[x][y].account","                var payment = {account: account, amount: amount, currency: currency, node: lines[x][y].node}","                ","                callback(payment, account_id)","                console.log(\"it works\")","                         ","                     }","                     y++","                loop()","                }","                    ","                    ","               ","               ","                }","                else x++, y =0, loop()","            }else q++, console.log(\"swarm-redistribution for currency: \"+lines[0][0].currency +\" is done. loading next currency...\"),ACCOUNT = account_id, get_collection();","         }//create outgoing payments to everyone in the swarm","    }","   ","","        ","}//end swarm_redistribution()"]}]}],[{"group":"doc","deltas":[{"start":{"row":46,"column":0},"end":{"row":46,"column":1},"action":"remove","lines":["}"]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":0},"end":{"row":37,"column":0},"action":"remove","lines":["function get_safety_net(callback){",""]}]}],[{"group":"doc","deltas":[{"start":{"row":40,"column":0},"end":{"row":41,"column":0},"action":"remove","lines":["    callback(doc)",""]}]}],[{"group":"doc","deltas":[{"start":{"row":42,"column":0},"end":{"row":42,"column":1},"action":"remove","lines":["}"]}]}]]},"ace":{"folds":[],"scrolltop":204.55556774139404,"scrollleft":0,"selection":{"start":{"row":42,"column":0},"end":{"row":42,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":13,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1419073731957,"hash":"f4cc156f1440bebfe131c5f50a8be362d6a1874a"}